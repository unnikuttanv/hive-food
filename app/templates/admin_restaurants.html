{% extends "base.html" %}
{% block content %}
<div class="row">
  <div class="col">
    <div class="card">
      <div class="actions" style="justify-content: space-between;">
        <div>
          <h2>Restaurant &amp; Menu Management</h2>
          <div class="muted">Add restaurants and their menu items. Users will pick from these when ordering.</div>
        </div>
        <a href="/"><button class="secondary">Back to Dashboard</button></a>
      </div>
      <hr/>
      <h3 style="font-size:15px; margin-bottom:10px;">Add new restaurant</h3>
      <form method="post" action="/admin/restaurants/new">
        <div class="row">
          <div class="col">
            <label>Restaurant name</label>
            <input name="name" required placeholder="Pizza Palace"/>
          </div>
          <div class="col">
            <label>URL (optional)</label>
            <input name="url" placeholder="https://..."/>
          </div>
        </div>
        <div style="margin-top:12px;">
          <button type="submit">Add Restaurant</button>
        </div>
      </form>
    </div>

    {% for r in restaurants %}
    <div class="card" id="restaurant-{{ r.id }}">
      <div class="actions" style="justify-content: space-between;">
        <div>
          <h2>{{ r.name }}</h2>
          {% if r.url %}<a class="muted" href="{{ r.url }}" target="_blank">{{ r.url }}</a>{% endif %}
        </div>
        <form method="post" action="/admin/restaurants/{{ r.id }}/delete" style="margin:0;" onsubmit="return confirm('Delete {{ r.name }} and all its menu items?');">
          <button class="danger" type="submit">Delete Restaurant</button>
        </form>
      </div>

      <hr/>
      <h3 style="font-size:15px; margin-bottom:10px;">Menu Items ({{ r.menu_items|length }})</h3>

      {% if r.menu_items|length > 0 %}
      <table>
        <thead>
          <tr>
            <th>Item</th>
            <th>Price (EUR)</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          {% for mi in r.menu_items %}
          <tr>
            <td><strong>{{ mi.name }}</strong></td>
            <td>{% if mi.price_eur is not none %}€{{ "%.2f"|format(mi.price_eur) }}{% else %}<span class="muted">—</span>{% endif %}</td>
            <td class="actions">
              <form method="post" action="/admin/restaurants/{{ r.id }}/menu/{{ mi.id }}/delete" style="margin:0;">
                <button class="danger" type="submit">Delete</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <p class="muted">No menu items yet. Add some below.</p>
      {% endif %}

      <div style="margin-top:12px; padding-top:12px; border-top:1px solid #eee;">
        <form method="post" action="/admin/restaurants/{{ r.id }}/menu/new">
          <div class="row">
            <div class="col">
              <label>Item name</label>
              <input name="name" required placeholder="Margherita Pizza"/>
            </div>
            <div class="col">
              <label>Price EUR (optional)</label>
              <input name="price_eur" type="number" step="0.01" min="0" placeholder="9.50"/>
            </div>
            <div class="col" style="display:flex;align-items:flex-end;">
              <button type="submit">Add Item</button>
            </div>
          </div>
        </form>
      </div>
    </div>
    {% endfor %}

    {% if restaurants|length == 0 %}
    <div class="card">
      <p class="muted">No restaurants yet. Add one above to get started.</p>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
