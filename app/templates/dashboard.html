{% extends "base.html" %}
{% block content %}
<div class="row">
  <div class="col">
    <div class="card">
      <div class="actions" style="justify-content: space-between;">
        <div>
          <h2>Order sessions</h2>
          <div class="muted">{% if current_user.is_admin %}Create a session, share the link, and everyone adds items until the deadline.{% else %}Browse sessions and add your order items before the deadline.{% endif %}</div>
        </div>
        {% if current_user.is_admin %}
        <a href="/sessions/new"><button>Create session</button></a>
        {% endif %}
      </div>
      <hr/>
      {% if sessions|length == 0 %}
        <p class="muted">No sessions yet. Create the first one.</p>
      {% else %}
        <table>
          <thead>
            <tr>
              <th>Session</th>
              <th>Restaurant</th>
              <th>Deadline</th>
              <th>Status</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {% for s in sessions %}
              <tr>
                <td><strong><a href="/sessions/{{ s.id }}">{{ s.title }}</a></strong><br/><span class="muted">Created {{ fmt_dt(s.created_at) }}</span></td>
                <td>
                  {{ s.restaurant }}
                  {% if s.restaurant_url %}<br/><a class="muted" href="{{ s.restaurant_url }}" target="_blank">Open restaurant link</a>{% endif %}
                </td>
                <td>{{ fmt_dt(s.deadline_at) }}</td>
                <td>
                  {% if s.status == "open" %}<span class="badge">Open</span>{% else %}<span class="badge" style="background:#ecfeff;color:#155e75;">Closed</span>{% endif %}
                </td>
                <td class="actions">
                  <a href="/sessions/{{ s.id }}"><button class="secondary">Open</button></a>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% endif %}
    </div>
  </div>

  <div class="col">
    <div class="card">
      <h2>Rules of thumb</h2>
      <ul class="muted">
        <li>Agree on one person who places the order.</li>
        <li>Use a clear deadline (e.g., “11:20”).</li>
        <li>Ask people to add prices when possible.</li>
        <li>Close the session once ordered to prevent late changes.</li>
      </ul>
    </div>

    {% if current_user.is_admin %}
    <div class="card">
      <div class="actions" style="justify-content: space-between;">
        <div>
          <h2>Admin</h2>
          <p class="muted">Manage users and system settings.</p>
        </div>
        <a href="/admin/users"><button>Manage Users</button></a>
      </div>
    </div>

    <div class="card">
      <h2>Admin notes</h2>
      <p class="muted">Allowed email domains are configured through environment variable <code>ALLOWED_EMAIL_DOMAINS</code>.</p>
      <p class="muted">This MVP bootstraps the first admin from <code>ADMIN_BOOTSTRAP_EMAIL</code>.</p>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
